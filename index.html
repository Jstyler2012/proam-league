<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Wellman Golf Club Pro-Am League</title>

<style>
:root{
--bg:#0b1220;
--panel:#0f1b33;
--text:#e8eefc;
--muted:#a9b7d6;
--brand:#47d7ac;
--brand2:#5aa7ff;
--danger:#ff5a7a;
--ok:#49e28b;
--border:rgba(255,255,255,.10);
--shadow:0 12px 40px rgba(0,0,0,.35);
--radius:18px;
}

*{box-sizing:border-box;}

body{
margin:0;
font-family:system-ui;
background:linear-gradient(180deg,var(--bg),#060b15);
color:var(--text);
}

.wrap{
max-width:1100px;
margin:auto;
padding:28px 18px 60px;
}

header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:18px;
flex-wrap:wrap;
gap:12px;
}

.logo{
width:44px;
height:44px;
border-radius:12px;
background:linear-gradient(135deg,var(--brand2),var(--brand));
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
color:#04101e;
}

.titleblock h1{
margin:0;
font-size:20px;
}

.titleblock p{
margin:2px 0 0;
color:var(--muted);
font-size:13px;
}

.pill{
border:1px solid var(--border);
padding:6px 10px;
border-radius:999px;
font-size:12px;
display:flex;
gap:6px;
align-items:center;
}

.dot{
width:8px;
height:8px;
border-radius:50%;
background:var(--ok);
}

.btn{
background:linear-gradient(135deg,var(--brand2),var(--brand));
border:none;
padding:8px 12px;
border-radius:10px;
cursor:pointer;
font-weight:bold;
}

.card{
border:1px solid var(--border);
border-radius:var(--radius);
margin-bottom:16px;
overflow:hidden;
}

.card .hd{
padding:12px 16px;
border-bottom:1px solid var(--border);
display:flex;
justify-content:space-between;
}

.card .bd{
padding:16px;
}

.badge{
padding:4px 8px;
border-radius:999px;
border:1px solid var(--border);
font-size:12px;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:8px;
border-bottom:1px solid var(--border);
font-size:13px;
}

.rank{
font-weight:bold;
}
</style>
</head>

<body>

<div class="wrap">

<header>

<div style="display:flex;gap:12px;align-items:center;">
<div class="logo">⛳</div>

<div class="titleblock">
<h1>Wellman Golf Club Pro-Am League</h1>
<p>Season 1: March 9 – June 21, 2026</p>
</div>
</div>

<div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">

<div class="pill">
<div id="healthDot" class="dot"></div>
<div id="healthText">API</div>
</div>

<div class="pill">
Week:
<div id="weekLabel">—</div>
</div>

<button class="btn" id="refreshBtn">Refresh</button>

</div>

</header>

<!-- Week Details -->

<div class="card">

<div class="hd">
<div>Week Details</div>
<div id="tournamentWeekBadge" class="badge">—</div>
</div>

<div class="bd" style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">

<img id="tournamentLogo" style="width:64px;height:64px;display:none;">

<div>

<div id="tournamentName" style="font-weight:bold;font-size:18px;">—</div>

<div id="tournamentDates" style="color:var(--muted);">—</div>

</div>

</div>

</div>

<!-- Leaderboard -->

<div class="card">

<div class="hd">
<div>Leaderboard</div>
<div id="lastUpdated" class="badge">—</div>
</div>

<div class="bd">

<table>

<thead>
<tr>
<th>Rank</th>
<th>Player</th>
<th>You</th>
<th>Pro</th>
<th>Combined</th>
</tr>
</thead>

<tbody id="lbBody">
<tr><td colspan="5">Loading…</td></tr>
</tbody>

</table>

</div>
</div>

</div>

<script>

const API = {
health:"/.netlify/functions/public/health",
schedule:"/.netlify/functions/public/schedule",
leaderboard:"/.netlify/functions/public/leaderboard"
};

const $=id=>document.getElementById(id);

let currentWeekId=null;

function fmtDateRange(a,b){
const s=new Date(a);
const e=new Date(b);
return s.toLocaleDateString()+" – "+e.toLocaleDateString();
}

function renderWeekDetails(w){

$("tournamentWeekBadge").textContent=w.label;

$("tournamentName").textContent=w.tournament_name;

$("tournamentDates").textContent=fmtDateRange(w.start_date,w.end_date);

if(w.logo_url){
$("tournamentLogo").src=w.logo_url;
$("tournamentLogo").style.display="block";
}
}

async function getJSON(url){
const r=await fetch(url);
return await r.json();
}

async function loadSchedule(){

const data=await getJSON(API.schedule);

return data.weeks;
}

function pickWeek(weeks){

const today=new Date();

for(const w of weeks){

const s=new Date(w.start_date);
const e=new Date(w.end_date);

if(today>=s && today<=e)
return w;
}

return weeks[0];
}

async function loadLeaderboard(week){

const data=await getJSON(API.leaderboard+"?week_id="+week.id);

$("weekLabel").textContent=week.label;

const rows=data.rows;

if(!rows.length){
$("lbBody").innerHTML="<tr><td colspan=5>No scores yet</td></tr>";
return;
}

$("lbBody").innerHTML=rows.map((r,i)=>`

<tr>

<td class="rank">#${i+1}</td>

<td>${r.player_name||"—"}</td>

<td>${r.playerScore??"—"}</td>

<td>${r.proScore??"—"}</td>

<td>${r.combined??"—"}</td>

</tr>

`).join("");

$("lastUpdated").textContent=new Date().toLocaleTimeString();
}

async function boot(){

$("healthText").textContent="ok";

const weeks=await loadSchedule();

const week=pickWeek(weeks);

currentWeekId=week.id;

renderWeekDetails(week);

await loadLeaderboard(week);
}

$("refreshBtn").onclick=boot;

boot();

</script>

</body>
</html>
